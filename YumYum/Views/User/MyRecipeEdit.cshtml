@* --麵包屑導覽-- *@
<div class="container custom-left mt-4 mb-4">

    @await Html.PartialAsync("_PartialBreadcrumb", (List<BreadcrumbItem>)ViewBag.Breadcrumbs)

</div>
@model YumYum.Models.ViewModels.MyRecipeViewModel



@* --tabs 卡片-- *@

<section class="section-content">
    <div class="container mt-5 mb-4 d-flex justify-content-center align-items-center">

        <div class="card text-center mb-2 ">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs nav-fill">
                    <li class="nav-item RecipeTitle">
                        <a class="nav-link active" asp-controller="User" asp-action="MyRecipeEdit">我的食譜</a>
                    </li>
                    <li class="nav-item RecipeTitle">
                        <a class="nav-link" asp-controller="User" asp-action="MyRecipeCollect">收藏食譜</a>
                    </li>

                </ul>
            </div>

            @if (Model.RecipeDetails != null && Model.RecipeDetails.Any())
            {

                @foreach (var recipe in Model.RecipeDetails.GroupBy(r => r.RecipeID))
                {

                    @switch (@recipe.First().RecipeStatusCode)
                    {
                        case 1:
                            @: <!-- Case 1 HTML -->
                            <div class="card mb-3 mx-auto" style="max-width: 95%;width: 100%;">
                                <!-- Your Case 1 content -->
                                <div class="row">
                                    <div class="col-md-3 d-flex justify-content-center align-items-center">
                                        <div class="card-img">
                                            @if (!string.IsNullOrEmpty(recipe.First().FieldShot))
                                            {
                                                <img src="@recipe.First().FieldShot"
                                                     class="rounded"
                                                     style="max-width: 100%;"
                                                     alt="recipe_intro"
                                                     onerror="this.src='/img/icon/EmptyPhoto.png';">
                                            }
                                            else
                                            {
                                                <img src="/img/icon/EmptyPhoto.png"
                                                     class="rounded"
                                                     style="max-width: 100%;"
                                                     alt="recipe_intro">
                                            }


                                        </div>
                                    </div>
                                    <div class="col-md-7">
                                        <div class="card-body2">
                                            <h4 class="card-title text-start">@recipe.First().RecipeName</h4>
                                            <p class="card-title text-start" id="UserID">@recipe.First().UserNickname</p>
                                            <p class="card-text text-start" id="RecipeDescript">@recipe.First().FieldDescript</p>
                                            <p class="card-title text-start" id="RecipeIngredients">
                                                食材:
                                                @foreach (var ingredient in recipe)
                                                {
                                                    @ingredient.IngredientName
                                                    <span>,</span>
                                                }

                                            </p>
                                            <div class="d-flex align-items-center">
                                                <img src="/img/icon/timer.svg" alt="timer">
                                                <div class="card-text text-start mb-0">
                                                    <small class="text-muted">@recipe.First().FinishMinute min</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2 d-flex justify-content-center align-items-center">
                                        <button type="button" class="btn btn-secondary">
                                            <svg height="20px" viewBox="0 -960 960 960" width="20px" fill="#30533F">
                                                <path d="M240-144v-600q0-29.7 21.15-50.85Q282.3-816 312-816h336q29.7 0 50.85 21.15Q720-773.7 720-744v600l-240-96-240 96Zm72-107 168-67 168 67v-493H312v493Zm0-493h336-336Z" fill="#e2e3cf" />
                                            </svg>
                                            編輯食譜
                                        </button>
                                    </div>
                                </div>
                            </div>
                            break;

                        case 2:
                            @: <!-- Case 2 HTML -->
                            <div class="PleaseEditCard">
                                <div class="card mb-3 mx-auto" style="max-width: 95%;width: 100%;">
                                    <!-- Your Case 2 content -->
                                    <div class="row">
                                        <div class="col-md-3 d-flex justify-content-center align-items-center">
                                            <div class="card-img  position-relative">
                                                <img src="/img/icon/pleaseEditStamp.svg" style="max-width: 50%;position: absolute;top: 50%;
                          left: 55%;
                          transform: translate(-50%, -50%); z-index: 2;">
                                                @if (!string.IsNullOrEmpty(recipe.First().FieldShot))
                                                {
                                                    <img src="@recipe.First().FieldShot"
                                                         class="rounded"
                                                         style="max-width: 100%;z-index: 1; position: relative;opacity:20%;"
                                                         alt="recipe_intro"
                                                         onerror="this.src='/img/icon/EmptyPhoto.png';">
                                                }
                                                else
                                                {
                                                    <img src="/img/icon/EmptyPhoto.png"
                                                         class="rounded"
                                                         style="max-width: 100%;z-index: 1; position: relative;opacity:20%;"
                                                         alt="recipe_intro">
                                                }
                                            </div>
                                        </div>
                                        <div class="col-md-7">
                                            <div class="card-body2 ">
                                                <h4 class="card-title text-start">@recipe.First().RecipeName</h4>
                                                <p class="card-title text-start" id="UserID">@recipe.First().UserNickname</p>
                                                <p class="card-text text-start" id="RecipeDescript">
                                                    @recipe.First().FieldDescript
                                                </p>

                                                <p class="card-title text-start" id="RecipeIngredients">
                                                    食材:
                                                    @{
                                                        var totalIngredients = recipe.Count(); var index = 0;
                                                    }
                                                    @foreach (var ingredient in recipe)
                                                    {
                                                        @ingredient.IngredientName
                                                        if (++index < totalIngredients)
                                                        {
                                                            <span>,</span>
                                                        }
                                                    }
                                                </p>

                                                <p class="card-text text-start"></p>
                                                <div class="d-flex align-items-center">
                                                    <img src="/img/icon/timer.svg" alt="timer">
                                                    <div class="card-text text-start mb-0"><small class="text-muted">@recipe.First().FinishMinute min</small></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2 d-flex justify-content-center align-items-center">
                                            <button type="button" class="btn btn-secondary ">
                                                <svg height="20px" viewBox="0 -960 960 960" width="20px" fill="#30533F"><path d="M240-144v-600q0-29.7 21.15-50.85Q282.3-816 312-816h336q29.7 0 50.85 21.15Q720-773.7 720-744v600l-240-96-240 96Zm72-107 168-67 168 67v-493H312v493Zm0-493h336-336Z" fill="#e2e3cf" /></svg>
                                                編輯食譜
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            break;

                        case 3:
                            @: <!-- Case 3 HTML -->
                            <div class="card mb-3 mx-auto" style="max-width: 95%;width: 100%;">
                                <!-- Your Case 3 content -->
                                <div class="row">
                                    <div class="col-md-3 d-flex justify-content-center align-items-center">
                                        <div class="card-img">
                                            @if (!string.IsNullOrEmpty(recipe.First().FieldShot))
                                            {
                                                <img src="@recipe.First().FieldShot"
                                                     class="rounded"
                                                     style="max-width: 100%;"
                                                     alt="..."
                                                     onerror="this.src='/img/icon/EmptyPhoto.png';">
                                            }
                                            else
                                            {
                                                <img src="/img/icon/EmptyPhoto.png"
                                                     class="rounded"
                                                     style="max-width: 100%;"
                                                     alt="...">
                                            }
                                        </div>
                                    </div>
                                    <div class="col-md-7">
                                        <div class="card-body2">
                                            <h4 class="card-title text-start">@recipe.First().RecipeName</h4>
                                            <p class="card-title text-start" id="UserID">@recipe.First().UserNickname</p>
                                            <p class="card-text text-start" id="RecipeDescript">@recipe.First().FieldDescript</p>
                                            <p class="card-title text-start" id="RecipeIngredients">
                                                食材:
                                                @foreach (var ingredient in recipe)
                                                {
                                                    @ingredient.IngredientName
                                                    <span>,</span>
                                                }
                                            </p>
                                            <div class="d-flex align-items-center">
                                                <img src="/img/icon/timer.svg" alt="timer">
                                                <div class="card-text text-start mb-0">
                                                    <small class="text-muted">@recipe.First().FinishMinute min</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2 d-flex justify-content-center align-items-center">
                                        <button type="button" class="btn btn-secondary">
                                            <svg height="20px" viewBox="0 -960 960 960" width="20px" fill="#30533F">
                                                <path d="M240-144v-600q0-29.7 21.15-50.85Q282.3-816 312-816h336q29.7 0 50.85 21.15Q720-773.7 720-744v600l-240-96-240 96Zm72-107 168-67 168 67v-493H312v493Zm0-493h336-336Z" fill="#e2e3cf" />
                                            </svg>
                                            編輯食譜
                                        </button>
                                    </div>
                                </div>
                            </div>
                            break;

                        case 4:
                            @: <!-- Case 4 HTML -->
                            <div class="card mb-3 mx-auto" style="max-width: 95%;width: 100%;">
                                <!-- Your Case 4 content -->
                                <div class="row">
                                    <div class="col-md-3 d-flex justify-content-center align-items-center">
                                        <div class="card-img">

                                            @if (!string.IsNullOrEmpty(recipe.First().FieldShot))
                                            {
                                                <img src="@recipe.First().FieldShot"
                                                     class="rounded"
                                                     style="max-width: 100%;"
                                                     alt="recipe_intro"
                                                     onerror="this.src='/img/icon/EmptyPhoto.png';">
                                            }
                                            else
                                            {
                                                <img src="/img/icon/EmptyPhoto.png"
                                                     class="rounded"
                                                     style="max-width: 100%;"
                                                     alt="recipe_intro">
                                            }

                                        </div>
                                    </div>
                                    <div class="col-md-7">
                                        <div class="card-body2">
                                            <h4 class="card-title text-start">@recipe.First().RecipeName</h4>
                                            <p class="card-title text-start" id="UserID">@recipe.First().UserNickname</p>
                                            <p class="card-text text-start" id="RecipeDescript">@recipe.First().FieldDescript</p>
                                            <p class="card-title text-start" id="RecipeIngredients">
                                                食材:
                                                @foreach (var ingredient in recipe)
                                                {
                                                    @ingredient.IngredientName
                                                    <span>,</span>
                                                }
                                            </p>
                                            <div class="d-flex align-items-center">
                                                <img src="/img/icon/timer.svg" alt="timer">
                                                <div class="card-text text-start mb-0">
                                                    <small class="text-muted">@recipe.First().FinishMinute min</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2 d-flex justify-content-center align-items-center">
                                        <button type="button" class="btn btn-secondary">
                                            <svg height="20px" viewBox="0 -960 960 960" width="20px" fill="#30533F">
                                                <path d="M240-144v-600q0-29.7 21.15-50.85Q282.3-816 312-816h336q29.7 0 50.85 21.15Q720-773.7 720-744v600l-240-96-240 96Zm72-107 168-67 168 67v-493H312v493Zm0-493h336-336Z" fill="#e2e3cf" />
                                            </svg>
                                            編輯食譜
                                        </button>
                                    </div>
                                </div>
                            </div>
                            break;

                        case 0:
                            @: <!-- Case 0 HTML -->
                            <div class="PleaseEditCard">
                                <div class="card mb-3 mx-auto" style="max-width: 95%;width: 100%;">
                                    <!-- Your Case 0 content -->
                                    <div class="row">
                                        <div class="col-md-3 d-flex justify-content-center align-items-center">
                                            <div class="card-img  position-relative">
                                                <button type="button" class="btn btn-secondary md-4" style="max-width: 50%;position: absolute;top: 50%;
                      left: 55%;
                      transform: translate(-50%, -50%); z-index: 2;">
                                                    草稿
                                                </button>

                                                @if (!string.IsNullOrEmpty(recipe.First().FieldShot))
                                                {
                                                    <img src="@recipe.First().FieldShot"
                                                         class="rounded"
                                                         style="max-width: 100%;z-index: 1; position: relative;opacity:20%;"
                                                         alt="recipe_intro"
                                                         onerror="this.src='/img/icon/EmptyPhoto.png';">
                                                }
                                                else
                                                {
                                                    <img src="/img/icon/EmptyPhoto.png"
                                                         class="rounded"
                                                         style="max-width: 100%;z-index: 1; position: relative;opacity:20%;"
                                                         alt="recipe_intro">
                                                }
                                            </div>
                                        </div>
                                        <div class="col-md-7">
                                            <div class="card-body2">
                                                <h4 class="card-title text-start">@recipe.First().RecipeName</h4>
                                                <p class="card-title text-start" id="UserID">@recipe.First().UserNickname</p>
                                                <p class="card-text text-start" id="RecipeDescript">
                                                    @recipe.First().FieldDescript
                                                </p>
                                                <p class="card-title text-start" id="RecipeIngredients">
                                                    食材:
                                                    @foreach (var ingredient in recipe)
                                                    {
                                                        @ingredient.IngredientName
                                                        <span>,</span>
                                                    }
                                                </p>
                                                <p class="card-text text-start"></p>
                                                <div class="d-flex align-items-center">
                                                    <img src="/img/icon/timer.svg" alt="timer">
                                                    <div class="card-text text-start mb-0"><small class="text-muted">@recipe.First().FinishMinute min</small></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2 align-self-center md-4">
                                                <form method="post" action="/User/Upload">
                                                <!-- 傳遞每個食譜的 RecipeID -->
                                                <input type="hidden" name="recipeId" value="@recipe.First().RecipeID" />
                                                <input type="hidden" name="recipeRecVersion" value="@recipe.First().RecipeRecVersion" /><!-- 傳遞 UserID -->
                                                <button type="submit" class="btn btn-secondary md-4" id="openModal">
                                                    <svg height="20px" viewBox="0 -960 960 960" width="20px" fill="#30533F">
                                                        <path d="M444-336v-342L339-573l-51-51 192-192 192 192-51 51-105-105v342h-72ZM263.72-192Q234-192 213-213.15T192-264v-72h72v72h432v-72h72v72q0 29.7-21.16 50.85Q725.68-192 695.96-192H263.72Z" fill="#e2e3cf" />
                                                    </svg>
                                                    立即發布
                                                </button>
                                            </form>
                                            


                                            <button type="button" class="btn btn-secondary ">
                                                <svg height="20px" viewBox="0 -960 960 960" width="20px" fill="#30533F"><path d="M240-144v-600q0-29.7 21.15-50.85Q282.3-816 312-816h336q29.7 0 50.85 21.15Q720-773.7 720-744v600l-240-96-240 96Zm72-107 168-67 168 67v-493H312v493Zm0-493h336-336Z" fill="#e2e3cf" /></svg>
                                                編輯食譜
                                            </button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            break;

                        default:
                            @: <!-- Default Case -->
                            <p>未找到符合條件的狀態</p>
                            break;
                    }

                }
            }
            else
            {
                <p>No recipes available.</p>
            }






            @* --發佈日期彈跳視窗跟 顯示訊息-- *@
            @* -- Toast 提示訊息 -- *@
            
            <div class="toast-container position-fixed bottom-0 end-0 p-3">
              <div id="successToast" class="toast align-items-center text-white bg-success border-0" 
                   role="alert" aria-live="assertive" aria-atomic="true" 
                   data-bs-autohide="true" data-bs-delay="1500">
                <div class="d-flex">
                  <div class="toast-body">
                    成功發布食譜！
                  </div>
                  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
              </div>
            </div>
            





        </div>







    </div>
</section>



@section Scripts {
    <script>

        document.getElementById('openModal').addEventListener('click', function (event) {
    event.preventDefault(); // 阻止表單的預設提交
    const form = event.target.closest('form'); // 找到表單

    // 使用 Fetch API 發送表單資料
    fetch(form.action, {
        method: form.method,
        body: new FormData(form)
    })
    .then(response => response.json())
    .then(data => {
        const toastEl = document.getElementById('successToast');
        const toastBody = toastEl.querySelector('.toast-body');
        
        if (data.success) {
            // 設置成功消息
            toastBody.textContent = data.message;
            toastEl.classList.remove('bg-danger');
            toastEl.classList.add('bg-success');
        } else {
            // 設置錯誤消息
            toastBody.textContent = data.message;
            toastEl.classList.remove('bg-success');
            toastEl.classList.add('bg-danger');
        }

        // 顯示 Toast
        const toast = new bootstrap.Toast(toastEl);
        toast.show();

        // 在 Toast 隱藏後重新加載頁面
        toastEl.addEventListener('hidden.bs.toast', () => {
            window.location.reload();
        });
    })
    .catch(error => {
        console.error('Error:', error);
        alert("發生錯誤，請稍後再試！");
    });
});


    </script>


}



